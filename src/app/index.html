<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Login</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<!-- LOGIN BUTTON -->
<div id="login-container" class="centered">
    <button id="login-btn">Login mit Discord</button>
</div>

<!-- MAIN CONTAINER NACH LOGIN -->
<div id="main-container" class="hidden">
    <div class="sidebar">
        <img id="avatar" src="" alt="Avatar">
        <p id="username"></p>
        <button id="logout-btn">Logout</button>
    </div>
    <div class="main-content">
        <h1>Willkommen!</h1>
        <p>Hier ist dein Content nach Login.</p>
    </div>
</div>

<script>
    const loginBtn = document.getElementById("login-btn");
    const loginContainer = document.getElementById("login-container");
    const mainContainer = document.getElementById("main-container");
    const avatarImg = document.getElementById("avatar");
    const usernameP = document.getElementById("username");
    const logoutBtn = document.getElementById("logout-btn");

    // Klick auf Login
    loginBtn.addEventListener("click", () => {
        const clientId = "1433117504170889317";
        const redirectUri = encodeURIComponent("https://nextjs-website-ruddy-omega.vercel.app/");
        const scope = encodeURIComponent("identify email guilds");
        const oauthUrl = `https://discord.com/api/oauth2/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=code&scope=${scope}`;
        window.location.href = oauthUrl;
    });

    // Nach Login: ?code=XYZ in URL
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get("code");

    if (code) {
        // âš¡ Hier muss dein Backend die echten Discord-Daten liefern
        fetch(`/get-discord-user?code=${code}`)
            .then(res => res.json())
            .then(discordUser => {
                avatarImg.src = discordUser.avatar;
                usernameP.textContent = discordUser.username; // echte Daten, kein Dummy
                loginContainer.style.display = "none";
                mainContainer.classList.remove("hidden");
            })
            .catch(err => {
                console.error("Fehler beim Laden der Discord-Daten:", err);
            });
    }

    logoutBtn.addEventListener("click", () => {
        window.location.href = "/"; // Seite neu laden
    });
</script>
</body>
</html>
